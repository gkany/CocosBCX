## 1. 侧链协议
> 理解侧链，可以先从侧链协议开始。

[**侧链协议是一种实现双向锚定（Two-way Peg）的协议。**](https://www.jianshu.com/p/cfd34ba38413)

> 通过侧链协议实现资产在主链和其它链之间互相转换，或是以独立的、隔离系统的形式，降低核心区块链上发生交易的次数。

[**侧链协议本质上是一种跨区块链解决方案。**](https://www.jianshu.com/p/cfd34ba38413)

> 通过这种解决方案，可以实现数字资产从第一个区块链到第二个区块链的转移，又可以在稍后的时间点从第二个区块链安全返回到第一个区块链。其中第一个区块链通常被称为主区块链或者主链，每二个区块链则被称为侧链。

最初，主链通常指的是比特币区块链，而现在主链可以是任何区块链。侧链协议被设想为一种允许数字资产在主链与侧链之间进行转移的方式，这种技术为开发区块链技术的新型应用和实验打开了一扇大门。

## 2. [侧链是什么](https://www.jianshu.com/p/26c4463da647)

侧链可以是一个独立的区块链，有自己按需定制的账本，共识机制，交易类型，脚本和合约的支持等。
侧链不能发行比特币，但可以通过支持与比特币区块链挂钩来引入和流通一定数量的比特币。
当比特币在侧链流通时，主链上对应的比特币会被锁定，直到比特币从侧链回到主链。

总之，侧链机制可以将一些定制化或高频的交易放到比特币主链之外进行，实现了比特币区块链的扩展。
侧链的核心原理在于能够冻结一条链上的资产，然后在另一条链上产生，可以通过多种方式来实现。当然最容易想到的就是SPV证明的方法。

### 2.1 SPV证明

在比特币系统中验证交易时，涉及到交易合法性检查、双重花费检查、脚本检查等。由于验证过程需要完整的 UTXO 记录，通常要由运行着完整功能节点的矿工来完成。

而很多时候，用户只关心与自己相关的那些交易，比如当用户收到其他人号称发来的比特币时，只希望能够知道交易是否合法、是否已在区块链中存在了足够的时间（即获得足够的确认），而不需要自己成为完整节点做出完整验证。

中本聪设计的简单支付验证（Simplified Payment Verification，SPV）可以实现这一点。SPV 能够以较小的代价判断某个支付交易是否已经被验证过（存在于区块链中），以及得到了多少算力保护（定位包含该交易的区块在区块链中的位置）。SPV 客户端只需要下载所有区块的区块头（Block Header），并进行简单的定位和计算工作就可以给出验证结论。

侧链协议中，用SPV来证明一个交易确实已经在区块链中发生过，称为SPV证明（SPV Proof）。一个SPV证明包括两部分内容：一组区块头的列表，表示工作量证明；一个特定输出（output）确实存在于某个区块中的密码学证明（特殊锁定）。

### 2.2 双向挂钩

**侧链协议的设计难点在于如何让资产在主链和侧链之间安全流转**。简而言之，接收资产的链必须确保发送资产的链上的币被可靠锁定。

![img](https:////upload-images.jianshu.io/upload_images/11530250-c6ed0273725b4718.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp)

image

上图演示了侧链和主链双向挂钩的过程

**侧链技术协议采用主侧链双向挂钩机制实现比特币从主链向侧链转移和返回**。主链和侧链需要对对方的特定交易做SPV验证。完整过程如下：

- 当用户要向侧链转移比特币时，首先在主链创建交易，待转移的比特币被发往一个特殊的输出。这些比特币在主链上被锁定。
- 等待一段确认期，使得上述交易获得足够的工作量缺人。
- 用户在侧链创建交易提取比特币，需要在这笔交易的输入指明上述主链被锁定的输出，并提供足够的SPV证明。
- 等待一段竞争期，防止双重花费攻击。
- 比特币在侧链上自由流通。
- 当用户想让比特币返回主链时，采取类似的反向操作。
  - 首先在侧链创建交易，待返回的比特币被发往一个特殊的输出。
  - 等待一段确认期。
  - 在主链用足够的对侧链输出的SPV证明来解锁最早被锁定的输出。
  - 竞争期过后，主链比特币恢复流通。

## 3. 侧链的技术原理

侧链区块链使用的技术大体与主链相似，侧链技术的核心在于与主链之间建立起桥梁。这一技术又被形象地称为楔入，按楔入的实现方式，可将其划分为多种类型，这里主要了解**双向楔入**和**联合楔入**。

### 3.1 双向楔入

双向楔入是指将主链上的资产以一个固定的或者是确定的汇率在侧链间转入或输出的机制。它的核心机制其实是将一条链上的部分资产锁定，在侧链上生成或者是解锁一部分等价的资产。

双向楔入方式是需要主链与侧链都支持简单支付验证证明（Simplified Payment Verification proof，SPV），双方资产的转移是通过生成锁定的SPV输出来实现的，基于SPV协议的流程图如下。

![img](https://img-blog.csdnimg.cn/20190515181426970.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9ja2NoYWluLWZhbnMuYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)



### 3.2 联合楔入

另一种常被提及的楔入方式是联合楔入，它的机制类似于比特币多重签名，链上的资产转移到一个由多方公证人控制的多重签名地址，并由多方的控制权来锁定资产，进行资产的转移，其动作原理如下图所示。

![img](https://img-blog.csdnimg.cn/20190515181441837.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9ja2NoYWluLWZhbnMuYmxvZy5jc2RuLm5ldA==,size_16,color_FFFFFF,t_70)



## 4. [侧链的好处](https://www.jianshu.com/p/9a1721d27793)

* **主链缺乏的功能，侧链来提供。**
  比如比特币网络没有智能合约的功能，但可以通过侧链来实现这一功能。

* **如果主链的运行效率低下，可以将主链部分功能转移到侧链来实施。**
  比如主链的转账速度很慢，没有办法满足日常支付需求，我们可以开发闪电网络来作为侧链满足日常的支付。同样是因为性能低下，以太坊没有办法支持大型商业级的DAPP（去中心化应用），可以通过侧链开发来实现。



## 5. 侧链更广泛理解

抛开技术上的严谨性，可以采用另外一种更为简单的方式来理解侧链，**一切为原来的主网络提供支持或者服务的网络都可以叫做侧链**，不用在乎这个侧链是否采用区块链技术。比如：

* 1. 第三方支付网络（支付宝/微信），可以把银行网络想象成为主链，而第三方支付就是一种侧链。

* 2. 加密货币交易，把比特币等虚拟货币等自由的网络看成是主链，那交易所可以看成一个侧链。

* 3. RSK 和Loom，他们分别是针对比特币和以太坊主链单独开发出来的侧链。

> 第一种应用，里面的主链和侧链都是中心化的。
> 第二种应用，主链是去中心化，侧链是中心化的
> 第三种应用，主链是去中心化，侧链也是去中心化

随着区块链技术的深入，我们可以看到人类的价值交换活动，会慢慢的从第一种应用逐步过渡到第三种应用。



## 6. 侧链的应用

* **闪电网络** -- 在比特币之上建立了一个结算层，在比特币之上建立了一个结算层，解决小额微支付问题。
* **BTC Relay**  -- 被认为是区块链上的第一个侧链。其实质是以太坊的一个智能合约。把以太坊网络与比特币网络通过使用以太坊的智能合约连接起来，可以使用户在以太坊上验证比特币交易。











